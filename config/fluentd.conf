<source>
  @type monitor_agent
  bind 0.0.0.0
  port 24220
</source>

<source>
  @type tail
  path "/var/log/*/*/*.log"
  tag "tractor.*"
  read_from_head true

  <parse>
    @type none
  </parse>
</source>

<filter tractor.**>
  @type tractor_metadata
</filter>

<filter tractor.**>
  @type regex_match
  match_patern /^====\[(?<time>\d+\/\d+\/\d+ \d+\:\d+\:\d+).+ on (?<blade>.+) \]====$/
  match_name init-command
  help_message "Command started at %{time} on computer %{blade}"
</filter>

<filter tractor.**>
  @type regex_match
  match_patern /^====\[(?<time>\d+\/\d+\/\d+ \d+\:\d+\:\d+).+ exit code: (?<code>\d)\]====$/
  match_name exit-command
  help_message "Command exited with status %{code} at %{time}"
</filter>

<filter tractor.**>
  @type missing_key

  key_name match
</filter>

<match tractor.**>
  @type http

  endpoint http://harvest-api:3000/logs/record
  json_array true

  <format>
    @type json
  </format>
  <buffer>
    flush_interval 0.1s
  </buffer>
</match>
